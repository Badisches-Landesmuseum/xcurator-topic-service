import logging
import os
import sys
from datetime import datetime
from unittest import TestCase
#if 'topic_modeling_train' not in sys.path[0]:
 #   path = os.path.join(sys.path[0], 'topic_modeling_train')
  #  sys.path.insert(0, path)
from infrastructure.mongo_db import MongoDB

from infrastructure.model_setup import ModelSetup
from repositories.detection_result_repository import DetectionResultRepository

logging.info(os.path)

from messaging.detection_listener import TopicRabbitListener

from data_processing.data_matrix import DataMatrix
from data_processing.preprocessing.text_preprocessing import TextPreprocessing
from data_processing.handlers.text_handler import TextHandler
from py_config.application_config import YamlConfig
from data_processing.prediction_process import PredictionProcessClass
from models.xgboost import Xgboost
from models.lda import LDAModel
from data_processing.handlers.vector_handler import VectorHandler
from repositories.PickelRepository import PickelRepository
#from database.detection_result_repository import DetectionResultRepository
from infrastructure.rabbitmq import RabbitMQ
from rabbitmq_proto_lib.manager import RabbitManager
from repositories.PickelRepository import PickelRepository
from resolvers.topic_modeling_resolver import TopicModelingResolver
from models.topic_collection import TopicCollection
from models.topic import Topic


class TestDetectionResultRepository(TestCase):


    def test_exists_page(self):
        ervice, mongodb = TestDetectionResultRepository.setup_mongo(self)
        # resolver = TestDetectionResultRepository(service=service, mongodb=mongo)
        document_id = '11'
        project_id = '606ee5bf6769f83e24dc16cc'
        page_id = '122'
        info = ''

        result = DetectionResultRepository.exists_page(
            DetectionResultRepository(mongodb, 'topic_modeling_collection'), page_id=page_id)
        self.assertTrue(result == True)

    def test_get_page_top_topics(self):
        service, mongodb = TestDetectionResultRepository.setup_mongo(self)
        #resolver = TestDetectionResultRepository(service=service, mongodb=mongo)
        document_id = '11'
        project_id = '606ee5bf6769f83e24dc16cc'
        page_id = '122'
        info = ''
        expected_result = [['strom', 'kohle', 'katastrophe'], ['luther', 'seite', 'reich'],
                           ['senat', 'kammer', 'zeuge'], ['dresden', 'halle', 'berlin'],
                           ['selbstverwaltung', 'teil', 'burgermeister'], ['platz', 'gebaude', 'straen'],
                           ['perspektive', 'kontext', 'konzept'], ['schule', 'berufsbildung', 'ubergang'],
                           ['schrumpfung', 'folge', 'lebensverhaltnisse'], ['radio', 'sender', 'medium'],
                           ['soldat', 'militar', 'streitkrafte'], ['gmbh', 'mahler', 'harald'],
                           ['partei', 'landtag', 'wahlprogramm'], ['schule', 'schulerinnen', 'abitur'],
                           ['gas', 'erdgas', 'pipeline'], ['hitler', 'spd', 'ende'],
                           ['staatsburgerschaft', 'staatsangehorigkeit', 'einburgerung'],
                           ['honecker', 'plan', 'mittag'], ['geschichte', 'figur', 'zuschauer'],
                           ['html', 'pdf', 'spiegel'], ['uhr', 'nachricht', 'minute'],
                           ['percent', 'development', 'billion']]

        result = DetectionResultRepository.get_page_top_topics(DetectionResultRepository(mongodb, 'topic_modeling_collection'), page_id=page_id)

        print('result_test_get_page_top_topics')
        print(result)

        res = DetectionResultRepository.exists_page(DetectionResultRepository(mongodb, 'topic_modeling_collection'), page_id= page_id)

        self.assertTrue(res == True)
        self.assertTrue(result == expected_result)

    def test_get_page_topics(self):
        service, mongodb = TestDetectionResultRepository.setup_mongo(self)
        # resolver = TestDetectionResultRepository(service=service, mongodb=mongo)
        document_id = '11'
        project_id = '606ee5bf6769f83e24dc16cc'
        page_id = '122'
        info = ''
        expected_result = [TopicCollection(percentage=0.09988337606994038, topics=[Topic(percentage=0.086, word='energie'), Topic(percentage=0.03, word='strom'), Topic(percentage=0.017, word='tschernobyl'), Topic(percentage=0.015, word='bau'), Topic(percentage=0.015, word='anteil'), Topic(percentage=0.013, word='kohle'), Topic(percentage=0.013, word='ausbau'), Topic(percentage=0.011, word='katastrophe'), Topic(percentage=0.011, word='energieeffizienz'), Topic(percentage=0.011, word='anlage')]), TopicCollection(percentage=0.0485314193661723, topics=[Topic(percentage=0.114, word='martin'), Topic(percentage=0.065, word='luther'), Topic(percentage=0.038, word='king'), Topic(percentage=0.026, word='rede'), Topic(percentage=0.015, word='reformation'), Topic(percentage=0.01, word='traum'), Topic(percentage=0.009, word='seite'), Topic(percentage=0.009, word='reich'), Topic(percentage=0.008, word='zeitalter'), Topic(percentage=0.007, word='rassentrennung')]), TopicCollection(percentage=0.03853972496526014, topics=[Topic(percentage=0.053, word='ravensbruck'), Topic(percentage=0.044, word='kongress'), Topic(percentage=0.043, word='prasidenten'), Topic(percentage=0.03, word='exekutive'), Topic(percentage=0.028, word='senat'), Topic(percentage=0.026, word='prasident'), Topic(percentage=0.021, word='legislative'), Topic(percentage=0.017, word='system'), Topic(percentage=0.014, word='kammer'), Topic(percentage=0.013, word='zeuge')]), TopicCollection(percentage=0.037248790932241226, topics=[Topic(percentage=0.133, word='leipzig'), Topic(percentage=0.095, word='dresden'), Topic(percentage=0.054, word='halle'), Topic(percentage=0.026, word='berlin'), Topic(percentage=0.021, word='jena'), Topic(percentage=0.017, word='sachsen'), Topic(percentage=0.012, word='magdeburg'), Topic(percentage=0.011, word='chemnitz'), Topic(percentage=0.011, word='saale'), Topic(percentage=0.01, word='erfurt')]), TopicCollection(percentage=0.029203786660438772, topics=[Topic(percentage=0.357, word='gemeinde'), Topic(percentage=0.097, word='kreis'), Topic(percentage=0.035, word='selbstverwaltung'), Topic(percentage=0.022, word='teil'), Topic(percentage=0.02, word='stadten'), Topic(percentage=0.019, word='burgermeister'), Topic(percentage=0.017, word='gemeinschaft'), Topic(percentage=0.014, word='landkreis'), Topic(percentage=0.011, word='jugendweihe'), Topic(percentage=0.01, word='landkreise')]), TopicCollection(percentage=0.028326507049429434, topics=[Topic(percentage=0.263, word='stadt'), Topic(percentage=0.019, word='bau'), Topic(percentage=0.018, word='architektur'), Topic(percentage=0.017, word='platz'), Topic(percentage=0.014, word='gebaude'), Topic(percentage=0.014, word='straen'), Topic(percentage=0.012, word='strae'), Topic(percentage=0.011, word='zentrum'), Topic(percentage=0.011, word='architekt'), Topic(percentage=0.01, word='ort')]), TopicCollection(percentage=0.027579609867563644, topics=[Topic(percentage=0.037, word='erfahrung'), Topic(percentage=0.037, word='herausforderung'), Topic(percentage=0.029, word='perspektive'), Topic(percentage=0.027, word='ansatz'), Topic(percentage=0.021, word='blick'), Topic(percentage=0.02, word='kontext'), Topic(percentage=0.017, word='aspekt'), Topic(percentage=0.016, word='rahmen'), Topic(percentage=0.016, word='moglichkeiten'), Topic(percentage=0.016, word='konzept')]), TopicCollection(percentage=0.02689664126969069, topics=[Topic(percentage=0.103, word='ausbildung'), Topic(percentage=0.048, word='berufsausbildung'), Topic(percentage=0.045, word='beruf'), Topic(percentage=0.031, word='betrieb'), Topic(percentage=0.018, word='bildung'), Topic(percentage=0.016, word='system'), Topic(percentage=0.015, word='schule'), Topic(percentage=0.014, word='berufsbildung'), Topic(percentage=0.013, word='ubergang'), Topic(percentage=0.013, word='auszubildende')]), TopicCollection(percentage=0.025015073250040598, topics=[Topic(percentage=0.082, word='infrastruktur'), Topic(percentage=0.037, word='bau'), Topic(percentage=0.02, word='verkehr'), Topic(percentage=0.018, word='kommune'), Topic(percentage=0.016, word='schrumpfung'), Topic(percentage=0.012, word='folge'), Topic(percentage=0.011, word='wachstum'), Topic(percentage=0.011, word='stadtentwicklung'), Topic(percentage=0.011, word='gebiet'), Topic(percentage=0.011, word='lebensverhaltnisse')]), TopicCollection(percentage=0.02428503364894739, topics=[Topic(percentage=0.077, word='rundfunk'), Topic(percentage=0.075, word='radio'), Topic(percentage=0.06, word='fernsehen'), Topic(percentage=0.047, word='sender'), Topic(percentage=0.044, word='programm'), Topic(percentage=0.014, word='angebot'), Topic(percentage=0.011, word='horfunk'), Topic(percentage=0.011, word='medium'), Topic(percentage=0.009, word='sendung'), Topic(percentage=0.009, word='fernsehsender')]), TopicCollection(percentage=0.02054470595633387, topics=[Topic(percentage=0.084, word='bundeswehr'), Topic(percentage=0.072, word='einsatz'), Topic(percentage=0.059, word='soldat'), Topic(percentage=0.031, word='militar'), Topic(percentage=0.026, word='streitkrafte'), Topic(percentage=0.025, word='verteidigung'), Topic(percentage=0.023, word='armee'), Topic(percentage=0.016, word='dienst'), Topic(percentage=0.014, word='nva'), Topic(percentage=0.013, word='wehrpflicht')]), TopicCollection(percentage=0.017631112401185235, topics=[Topic(percentage=0.176, word='mitarbeiter'), Topic(percentage=0.085, word='foto'), Topic(percentage=0.052, word='dm'), Topic(percentage=0.045, word='mitarbeiterin'), Topic(percentage=0.027, word='einrichtung'), Topic(percentage=0.026, word='gmbh'), Topic(percentage=0.025, word='ute'), Topic(percentage=0.024, word='mahler'), Topic(percentage=0.022, word='werner'), Topic(percentage=0.022, word='harald')]), TopicCollection(percentage=0.01592765135928792, topics=[Topic(percentage=0.134, word='partei'), Topic(percentage=0.026, word='landtagswahl'), Topic(percentage=0.023, word='landtag'), Topic(percentage=0.019, word='stimme'), Topic(percentage=0.017, word='forderung'), Topic(percentage=0.017, word='wahlprogramm'), Topic(percentage=0.016, word='wahl'), Topic(percentage=0.013, word='bayer'), Topic(percentage=0.012, word='landesverband'), Topic(percentage=0.012, word='europawahl')]), TopicCollection(percentage=0.014115219342491507, topics=[Topic(percentage=0.076, word='schule'), Topic(percentage=0.04, word='bildung'), Topic(percentage=0.025, word='gymnasium'), Topic(percentage=0.024, word='schuler'), Topic(percentage=0.017, word='schulerinnen'), Topic(percentage=0.016, word='deutschland'), Topic(percentage=0.014, word='abitur'), Topic(percentage=0.011, word='bildungssystem'), Topic(percentage=0.01, word='grundschule'), Topic(percentage=0.01, word='bundeslandern')]), TopicCollection(percentage=0.012571437409461286, topics=[Topic(percentage=0.043, word='gas'), Topic(percentage=0.037, word='gazprom'), Topic(percentage=0.032, word='ol'), Topic(percentage=0.024, word='erdgas'), Topic(percentage=0.024, word='milliarde'), Topic(percentage=0.021, word='kubikmeter'), Topic(percentage=0.02, word='stream'), Topic(percentage=0.018, word='erdol'), Topic(percentage=0.017, word='pipeline'), Topic(percentage=0.017, word='ukraine')]), TopicCollection(percentage=0.011849972539840579, topics=[Topic(percentage=0.049, word='hitler'), Topic(percentage=0.039, word='nsdap'), Topic(percentage=0.012, word='spd'), Topic(percentage=0.01, word='nationalsozialist'), Topic(percentage=0.009, word='hindenburg'), Topic(percentage=0.009, word='papen'), Topic(percentage=0.009, word='staat'), Topic(percentage=0.008, word='reichskanzler'), Topic(percentage=0.008, word='ende'), Topic(percentage=0.008, word='kpd')]), TopicCollection(percentage=0.011617903282949465, topics=[Topic(percentage=0.092, word='staatsburgerschaft'), Topic(percentage=0.092, word='staatsangehorigkeit'), Topic(percentage=0.041, word='auslander'), Topic(percentage=0.029, word='einburgerung'), Topic(percentage=0.02, word='ausland'), Topic(percentage=0.02, word='person'), Topic(percentage=0.02, word='wahlrecht'), Topic(percentage=0.019, word='aufenthalt'), Topic(percentage=0.015, word='auslandern'), Topic(percentage=0.014, word='staatsangehorigen')]), TopicCollection(percentage=0.010946914945382665, topics=[Topic(percentage=0.034, word='honecker'), Topic(percentage=0.016, word='mark'), Topic(percentage=0.016, word='plan'), Topic(percentage=0.012, word='mittag'), Topic(percentage=0.012, word='erich'), Topic(percentage=0.011, word='versorgung'), Topic(percentage=0.011, word='politburo'), Topic(percentage=0.011, word='information'), Topic(percentage=0.01, word='genosse'), Topic(percentage=0.01, word='volkswirtschaft')]), TopicCollection(percentage=0.010781365722728737, topics=[Topic(percentage=0.035, word='publikum'), Topic(percentage=0.031, word='geschichte'), Topic(percentage=0.02, word='figur'), Topic(percentage=0.02, word='szene'), Topic(percentage=0.019, word='theater'), Topic(percentage=0.019, word='inszenierung'), Topic(percentage=0.014, word='realitat'), Topic(percentage=0.012, word='ereignis'), Topic(percentage=0.012, word='zuschauer'), Topic(percentage=0.011, word='darstellung')]), TopicCollection(percentage=0.010562904415387611, topics=[Topic(percentage=0.335, word='zugriff'), Topic(percentage=0.127, word='html'), Topic(percentage=0.107, word='pdf'), Topic(percentage=0.057, word='2017'), Topic(percentage=0.037, word='2018'), Topic(percentage=0.023, word='spiegel'), Topic(percentage=0.013, word='bpb'), Topic(percentage=0.012, word='2019'), Topic(percentage=0.012, word='htm'), Topic(percentage=0.01, word='zahl')]), TopicCollection(percentage=0.010537706481425093, topics=[Topic(percentage=0.311, word='tag'), Topic(percentage=0.069, word='woche'), Topic(percentage=0.048, word='zeit'), Topic(percentage=0.047, word='stunde'), Topic(percentage=0.039, word='uhr'), Topic(percentage=0.032, word='monat'), Topic(percentage=0.019, word='nacht'), Topic(percentage=0.011, word='nachricht'), Topic(percentage=0.011, word='minute'), Topic(percentage=0.009, word='morgen')]), TopicCollection(percentage=0.010236145793358622, topics=[Topic(percentage=0.026, word='economic'), Topic(percentage=0.02, word='percent'), Topic(percentage=0.013, word='areas'), Topic(percentage=0.013, word='government'), Topic(percentage=0.013, word='development'), Topic(percentage=0.013, word='population'), Topic(percentage=0.012, word='world'), Topic(percentage=0.011, word='billion'), Topic(percentage=0.011, word='rural'), Topic(percentage=0.01, word='growth')])]



        result = DetectionResultRepository.get_page_topics(
            DetectionResultRepository(mongodb, 'topic_modeling_collection'), page_id=page_id)

        print('result_test_get_page_topics')
        print(result)

        res = DetectionResultRepository.exists_page(DetectionResultRepository(mongodb, 'topic_modeling_collection'),
                                                    page_id=page_id)

        self.assertTrue(res == True)
        self.assertTrue(result == expected_result)

    def test_get_document_topics(self):
        service, mongodb = TestDetectionResultRepository.setup_mongo(self)
        # resolver = TestDetectionResultRepository(service=service, mongodb=mongo)
        document_id = '11'
        project_id = '606ee5bf6769f83e24dc16cc'
        page_id = '122'
        info = ''

        result = DetectionResultRepository.get_document_topics(
            DetectionResultRepository(mongodb, 'topic_modeling_collection'), document_id, project_id)

        print('result_test_get_document_topics')
        print(result)

        res = DetectionResultRepository.exists_page(DetectionResultRepository(mongodb, 'topic_modeling_collection'),
                                                    page_id=page_id)

        self.assertTrue(res == True)

    def test_get_page_paragraph_topics(self):
        service, mongodb = TestDetectionResultRepository.setup_mongo(self)
        # resolver = TestDetectionResultRepository(service=service, mongodb=mongo)
        document_id = '11'
        project_id = '606ee5bf6769f83e24dc16cc'
        page_id = '122'
        info = ''
        expected_out = ([[0, 3], [3, 86], [86, 159], [159, 213], [213, 305], [305, 324], [324, 330], [330, 416], [416, 513], [513, 616], [616, 722], [722, 797], [797, 803], [803, 906], [906, 1009], [1009, 1046], [1046, 1153], [1153, 1251], [1251, 1356], [1356, 1455], [1455, 1527], [1527, 1533], [1533, 1626], [1626, 1727], [1727, 1773], [1773, 1855], [1855, 1956], [1956, 2018], [2018, 2105], [2105, 2185], [2185, 2190], [2190, 2190]], [TopicCollection(percentage=0.0, topics=[Topic(percentage=0.0, word='')]), [TopicCollection(percentage=0.02680627262247918, topics=[Topic(percentage=0.114, word='martin'), Topic(percentage=0.065, word='luther'), Topic(percentage=0.038, word='king'), Topic(percentage=0.026, word='rede'), Topic(percentage=0.015, word='reformation'), Topic(percentage=0.01, word='traum'), Topic(percentage=0.009, word='seite'), Topic(percentage=0.009, word='reich'), Topic(percentage=0.008, word='zeitalter'), Topic(percentage=0.007, word='rassentrennung')])], [TopicCollection(percentage=0.020934376539993044, topics=[Topic(percentage=0.053, word='ravensbruck'), Topic(percentage=0.044, word='kongress'), Topic(percentage=0.043, word='prasidenten'), Topic(percentage=0.03, word='exekutive'), Topic(percentage=0.028, word='senat'), Topic(percentage=0.026, word='prasident'), Topic(percentage=0.021, word='legislative'), Topic(percentage=0.017, word='system'), Topic(percentage=0.014, word='kammer'), Topic(percentage=0.013, word='zeuge')])], [TopicCollection(percentage=0.015389652783685074, topics=[Topic(percentage=0.134, word='partei'), Topic(percentage=0.026, word='landtagswahl'), Topic(percentage=0.023, word='landtag'), Topic(percentage=0.019, word='stimme'), Topic(percentage=0.017, word='forderung'), Topic(percentage=0.017, word='wahlprogramm'), Topic(percentage=0.016, word='wahl'), Topic(percentage=0.013, word='bayer'), Topic(percentage=0.012, word='landesverband'), Topic(percentage=0.012, word='europawahl')])], [TopicCollection(percentage=0.02163067185871152, topics=[Topic(percentage=0.054, word='terrorismus'), Topic(percentage=0.048, word='anschlagen'), Topic(percentage=0.033, word='organisation'), Topic(percentage=0.028, word='alqaida'), Topic(percentage=0.022, word='ziel'), Topic(percentage=0.02, word='september'), Topic(percentage=0.018, word='kampf'), Topic(percentage=0.015, word='terrorist'), Topic(percentage=0.015, word='terror'), Topic(percentage=0.015, word='anschlag')])], [TopicCollection(percentage=0.02143076872410035, topics=[Topic(percentage=0.076, word='schule'), Topic(percentage=0.04, word='bildung'), Topic(percentage=0.025, word='gymnasium'), Topic(percentage=0.024, word='schuler'), Topic(percentage=0.017, word='schulerinnen'), Topic(percentage=0.016, word='deutschland'), Topic(percentage=0.014, word='abitur'), Topic(percentage=0.011, word='bildungssystem'), Topic(percentage=0.01, word='grundschule'), Topic(percentage=0.01, word='bundeslandern')])], [TopicCollection(percentage=0.022002832790949618, topics=[Topic(percentage=0.357, word='gemeinde'), Topic(percentage=0.097, word='kreis'), Topic(percentage=0.035, word='selbstverwaltung'), Topic(percentage=0.022, word='teil'), Topic(percentage=0.02, word='stadten'), Topic(percentage=0.019, word='burgermeister'), Topic(percentage=0.017, word='gemeinschaft'), Topic(percentage=0.014, word='landkreis'), Topic(percentage=0.011, word='jugendweihe'), Topic(percentage=0.01, word='landkreise')])], [TopicCollection(percentage=0.0212116616465396, topics=[Topic(percentage=0.084, word='bundeswehr'), Topic(percentage=0.072, word='einsatz'), Topic(percentage=0.059, word='soldat'), Topic(percentage=0.031, word='militar'), Topic(percentage=0.026, word='streitkrafte'), Topic(percentage=0.025, word='verteidigung'), Topic(percentage=0.023, word='armee'), Topic(percentage=0.016, word='dienst'), Topic(percentage=0.014, word='nva'), Topic(percentage=0.013, word='wehrpflicht')])], [TopicCollection(percentage=0.020736018439145527, topics=[Topic(percentage=0.263, word='stadt'), Topic(percentage=0.019, word='bau'), Topic(percentage=0.018, word='architektur'), Topic(percentage=0.017, word='platz'), Topic(percentage=0.014, word='gebaude'), Topic(percentage=0.014, word='straen'), Topic(percentage=0.012, word='strae'), Topic(percentage=0.011, word='zentrum'), Topic(percentage=0.011, word='architekt'), Topic(percentage=0.01, word='ort')])], [TopicCollection(percentage=0.01596722606339482, topics=[Topic(percentage=0.085, word='kunst'), Topic(percentage=0.056, word='kunstler'), Topic(percentage=0.027, word='galerie'), Topic(percentage=0.026, word='ausstellung'), Topic(percentage=0.015, word='werk'), Topic(percentage=0.014, word='kunste'), Topic(percentage=0.012, word='kultur'), Topic(percentage=0.012, word='kunstlern'), Topic(percentage=0.009, word='dresden'), Topic(percentage=0.009, word='leipzig')])], TopicCollection(percentage=0.0, topics=[Topic(percentage=0.0, word='')]), TopicCollection(percentage=0.0, topics=[Topic(percentage=0.0, word='')]), [TopicCollection(percentage=0.0204528130092269, topics=[Topic(percentage=0.026, word='economic'), Topic(percentage=0.02, word='percent'), Topic(percentage=0.013, word='areas'), Topic(percentage=0.013, word='government'), Topic(percentage=0.013, word='development'), Topic(percentage=0.013, word='population'), Topic(percentage=0.012, word='world'), Topic(percentage=0.011, word='billion'), Topic(percentage=0.011, word='rural'), Topic(percentage=0.01, word='growth')])], [TopicCollection(percentage=0.02045258804588316, topics=[Topic(percentage=0.335, word='zugriff'), Topic(percentage=0.127, word='html'), Topic(percentage=0.107, word='pdf'), Topic(percentage=0.057, word='2017'), Topic(percentage=0.037, word='2018'), Topic(percentage=0.023, word='spiegel'), Topic(percentage=0.013, word='bpb'), Topic(percentage=0.012, word='2019'), Topic(percentage=0.012, word='htm'), Topic(percentage=0.01, word='zahl')])], [TopicCollection(percentage=0.020452517615845302, topics=[Topic(percentage=0.233, word='datum'), Topic(percentage=0.218, word='information'), Topic(percentage=0.014, word='zugang'), Topic(percentage=0.013, word='datenschutz'), Topic(percentage=0.01, word='data'), Topic(percentage=0.01, word='transparenz'), Topic(percentage=0.009, word='privatsphare'), Topic(percentage=0.008, word='ding'), Topic(percentage=0.008, word='grundlage'), Topic(percentage=0.008, word='uberwachung')])], [TopicCollection(percentage=0.020406643573441303, topics=[Topic(percentage=0.049, word='hitler'), Topic(percentage=0.039, word='nsdap'), Topic(percentage=0.012, word='spd'), Topic(percentage=0.01, word='nationalsozialist'), Topic(percentage=0.009, word='hindenburg'), Topic(percentage=0.009, word='papen'), Topic(percentage=0.009, word='staat'), Topic(percentage=0.008, word='reichskanzler'), Topic(percentage=0.008, word='ende'), Topic(percentage=0.008, word='kpd')])], [TopicCollection(percentage=0.01979471249629143, topics=[Topic(percentage=0.053, word='ravensbruck'), Topic(percentage=0.044, word='kongress'), Topic(percentage=0.043, word='prasidenten'), Topic(percentage=0.03, word='exekutive'), Topic(percentage=0.028, word='senat'), Topic(percentage=0.026, word='prasident'), Topic(percentage=0.021, word='legislative'), Topic(percentage=0.017, word='system'), Topic(percentage=0.014, word='kammer'), Topic(percentage=0.013, word='zeuge')])], [TopicCollection(percentage=0.020815551225751707, topics=[Topic(percentage=0.176, word='mitarbeiter'), Topic(percentage=0.085, word='foto'), Topic(percentage=0.052, word='dm'), Topic(percentage=0.045, word='mitarbeiterin'), Topic(percentage=0.027, word='einrichtung'), Topic(percentage=0.026, word='gmbh'), Topic(percentage=0.025, word='ute'), Topic(percentage=0.024, word='mahler'), Topic(percentage=0.022, word='werner'), Topic(percentage=0.022, word='harald')])], [TopicCollection(percentage=0.02079706216044006, topics=[Topic(percentage=0.174, word='bundesregierung'), Topic(percentage=0.092, word='bundesministerium'), Topic(percentage=0.082, word='bericht'), Topic(percentage=0.047, word='deutschland'), Topic(percentage=0.037, word='berlin'), Topic(percentage=0.032, word='bund'), Topic(percentage=0.023, word='auftrag'), Topic(percentage=0.02, word='entwicklung'), Topic(percentage=0.019, word='bundesministeriums'), Topic(percentage=0.017, word='innern')])], [TopicCollection(percentage=0.020784108131773494, topics=[Topic(percentage=0.114, word='martin'), Topic(percentage=0.065, word='luther'), Topic(percentage=0.038, word='king'), Topic(percentage=0.026, word='rede'), Topic(percentage=0.015, word='reformation'), Topic(percentage=0.01, word='traum'), Topic(percentage=0.009, word='seite'), Topic(percentage=0.009, word='reich'), Topic(percentage=0.008, word='zeitalter'), Topic(percentage=0.007, word='rassentrennung')])], [TopicCollection(percentage=0.020777836746807755, topics=[Topic(percentage=0.16, word='migration'), Topic(percentage=0.125, word='migranten'), Topic(percentage=0.048, word='migrantinnen'), Topic(percentage=0.03, word='ausland'), Topic(percentage=0.02, word='ruckkehr'), Topic(percentage=0.016, word='abwanderung'), Topic(percentage=0.015, word='auswanderung'), Topic(percentage=0.013, word='herkunftsland'), Topic(percentage=0.013, word='teil'), Topic(percentage=0.012, word='mobilitat')])], [TopicCollection(percentage=0.05766549323186835, topics=[Topic(percentage=0.086, word='energie'), Topic(percentage=0.03, word='strom'), Topic(percentage=0.017, word='tschernobyl'), Topic(percentage=0.015, word='bau'), Topic(percentage=0.015, word='anteil'), Topic(percentage=0.013, word='kohle'), Topic(percentage=0.013, word='ausbau'), Topic(percentage=0.011, word='katastrophe'), Topic(percentage=0.011, word='energieeffizienz'), Topic(percentage=0.011, word='anlage')])], [TopicCollection(percentage=0.020821235606387375, topics=[Topic(percentage=0.053, word='ravensbruck'), Topic(percentage=0.044, word='kongress'), Topic(percentage=0.043, word='prasidenten'), Topic(percentage=0.03, word='exekutive'), Topic(percentage=0.028, word='senat'), Topic(percentage=0.026, word='prasident'), Topic(percentage=0.021, word='legislative'), Topic(percentage=0.017, word='system'), Topic(percentage=0.014, word='kammer'), Topic(percentage=0.013, word='zeuge')])], [TopicCollection(percentage=0.021610152867127013, topics=[Topic(percentage=0.04, word='beitrag'), Topic(percentage=0.029, word='szene'), Topic(percentage=0.025, word='syrien'), Topic(percentage=0.021, word='deutschland'), Topic(percentage=0.021, word='salafisten'), Topic(percentage=0.018, word='minute'), Topic(percentage=0.017, word='video'), Topic(percentage=0.017, word='verfassungsschutz'), Topic(percentage=0.014, word='umgang'), Topic(percentage=0.013, word='claudia')])], [TopicCollection(percentage=0.020968102730218263, topics=[Topic(percentage=0.043, word='gas'), Topic(percentage=0.037, word='gazprom'), Topic(percentage=0.032, word='ol'), Topic(percentage=0.024, word='erdgas'), Topic(percentage=0.024, word='milliarde'), Topic(percentage=0.021, word='kubikmeter'), Topic(percentage=0.02, word='stream'), Topic(percentage=0.018, word='erdol'), Topic(percentage=0.017, word='pipeline'), Topic(percentage=0.017, word='ukraine')])], [TopicCollection(percentage=0.021634615381752462, topics=[Topic(percentage=0.263, word='stadt'), Topic(percentage=0.019, word='bau'), Topic(percentage=0.018, word='architektur'), Topic(percentage=0.017, word='platz'), Topic(percentage=0.014, word='gebaude'), Topic(percentage=0.014, word='straen'), Topic(percentage=0.012, word='strae'), Topic(percentage=0.011, word='zentrum'), Topic(percentage=0.011, word='architekt'), Topic(percentage=0.01, word='ort')])], [TopicCollection(percentage=0.021452199099431732, topics=[Topic(percentage=0.114, word='martin'), Topic(percentage=0.065, word='luther'), Topic(percentage=0.038, word='king'), Topic(percentage=0.026, word='rede'), Topic(percentage=0.015, word='reformation'), Topic(percentage=0.01, word='traum'), Topic(percentage=0.009, word='seite'), Topic(percentage=0.009, word='reich'), Topic(percentage=0.008, word='zeitalter'), Topic(percentage=0.007, word='rassentrennung')])], TopicCollection(percentage=0.0, topics=[Topic(percentage=0.0, word='')]), [TopicCollection(percentage=0.021222877634040998, topics=[Topic(percentage=0.037, word='erfahrung'), Topic(percentage=0.037, word='herausforderung'), Topic(percentage=0.029, word='perspektive'), Topic(percentage=0.027, word='ansatz'), Topic(percentage=0.021, word='blick'), Topic(percentage=0.02, word='kontext'), Topic(percentage=0.017, word='aspekt'), Topic(percentage=0.016, word='rahmen'), Topic(percentage=0.016, word='moglichkeiten'), Topic(percentage=0.016, word='konzept')])], [TopicCollection(percentage=0.021217510081957474, topics=[Topic(percentage=0.082, word='infrastruktur'), Topic(percentage=0.037, word='bau'), Topic(percentage=0.02, word='verkehr'), Topic(percentage=0.018, word='kommune'), Topic(percentage=0.016, word='schrumpfung'), Topic(percentage=0.012, word='folge'), Topic(percentage=0.011, word='wachstum'), Topic(percentage=0.011, word='stadtentwicklung'), Topic(percentage=0.011, word='gebiet'), Topic(percentage=0.011, word='lebensverhaltnisse')])], [TopicCollection(percentage=0.021152110150516754, topics=[Topic(percentage=0.114, word='martin'), Topic(percentage=0.065, word='luther'), Topic(percentage=0.038, word='king'), Topic(percentage=0.026, word='rede'), Topic(percentage=0.015, word='reformation'), Topic(percentage=0.01, word='traum'), Topic(percentage=0.009, word='seite'), Topic(percentage=0.009, word='reich'), Topic(percentage=0.008, word='zeitalter'), Topic(percentage=0.007, word='rassentrennung')])], [TopicCollection(percentage=0.02122322163811388, topics=[Topic(percentage=0.034, word='honecker'), Topic(percentage=0.016, word='mark'), Topic(percentage=0.016, word='plan'), Topic(percentage=0.012, word='mittag'), Topic(percentage=0.012, word='erich'), Topic(percentage=0.011, word='versorgung'), Topic(percentage=0.011, word='politburo'), Topic(percentage=0.011, word='information'), Topic(percentage=0.01, word='genosse'), Topic(percentage=0.01, word='volkswirtschaft')])], [TopicCollection(percentage=0.02122271082172188, topics=[Topic(percentage=0.134, word='partei'), Topic(percentage=0.026, word='landtagswahl'), Topic(percentage=0.023, word='landtag'), Topic(percentage=0.019, word='stimme'), Topic(percentage=0.017, word='forderung'), Topic(percentage=0.017, word='wahlprogramm'), Topic(percentage=0.016, word='wahl'), Topic(percentage=0.013, word='bayer'), Topic(percentage=0.012, word='landesverband'), Topic(percentage=0.012, word='europawahl')])], [TopicCollection(percentage=0.021203745631372065, topics=[Topic(percentage=0.073, word='wolf'), Topic(percentage=0.025, word='christa'), Topic(percentage=0.02, word='stefan'), Topic(percentage=0.019, word='biermann'), Topic(percentage=0.019, word='havemann'), Topic(percentage=0.016, word='heym'), Topic(percentage=0.015, word='robert'), Topic(percentage=0.013, word='schriftsteller'), Topic(percentage=0.011, word='manfred'), Topic(percentage=0.01, word='plenum')])], [TopicCollection(percentage=0.021604894312243703, topics=[Topic(percentage=0.076, word='schule'), Topic(percentage=0.04, word='bildung'), Topic(percentage=0.025, word='gymnasium'), Topic(percentage=0.024, word='schuler'), Topic(percentage=0.017, word='schulerinnen'), Topic(percentage=0.016, word='deutschland'), Topic(percentage=0.014, word='abitur'), Topic(percentage=0.011, word='bildungssystem'), Topic(percentage=0.01, word='grundschule'), Topic(percentage=0.01, word='bundeslandern')])], [TopicCollection(percentage=0.02153195346123953, topics=[Topic(percentage=0.176, word='mitarbeiter'), Topic(percentage=0.085, word='foto'), Topic(percentage=0.052, word='dm'), Topic(percentage=0.045, word='mitarbeiterin'), Topic(percentage=0.027, word='einrichtung'), Topic(percentage=0.026, word='gmbh'), Topic(percentage=0.025, word='ute'), Topic(percentage=0.024, word='mahler'), Topic(percentage=0.022, word='werner'), Topic(percentage=0.022, word='harald')])], [TopicCollection(percentage=0.021844907846890835, topics=[Topic(percentage=0.114, word='martin'), Topic(percentage=0.065, word='luther'), Topic(percentage=0.038, word='king'), Topic(percentage=0.026, word='rede'), Topic(percentage=0.015, word='reformation'), Topic(percentage=0.01, word='traum'), Topic(percentage=0.009, word='seite'), Topic(percentage=0.009, word='reich'), Topic(percentage=0.008, word='zeitalter'), Topic(percentage=0.007, word='rassentrennung')])], [TopicCollection(percentage=0.03946462117778747, topics=[Topic(percentage=0.066, word='mandat'), Topic(percentage=0.059, word='stimme'), Topic(percentage=0.048, word='wahl'), Topic(percentage=0.037, word='parlament'), Topic(percentage=0.025, word='liste'), Topic(percentage=0.021, word='wahlrecht'), Topic(percentage=0.02, word='mehrheit'), Topic(percentage=0.019, word='sitz'), Topic(percentage=0.017, word='sperrklausel'), Topic(percentage=0.017, word='abgeordnete')])], [TopicCollection(percentage=0.021225595952925325, topics=[Topic(percentage=0.133, word='leipzig'), Topic(percentage=0.095, word='dresden'), Topic(percentage=0.054, word='halle'), Topic(percentage=0.026, word='berlin'), Topic(percentage=0.021, word='jena'), Topic(percentage=0.017, word='sachsen'), Topic(percentage=0.012, word='magdeburg'), Topic(percentage=0.011, word='chemnitz'), Topic(percentage=0.011, word='saale'), Topic(percentage=0.01, word='erfurt')])], [TopicCollection(percentage=0.021347025936480316, topics=[Topic(percentage=0.053, word='ravensbruck'), Topic(percentage=0.044, word='kongress'), Topic(percentage=0.043, word='prasidenten'), Topic(percentage=0.03, word='exekutive'), Topic(percentage=0.028, word='senat'), Topic(percentage=0.026, word='prasident'), Topic(percentage=0.021, word='legislative'), Topic(percentage=0.017, word='system'), Topic(percentage=0.014, word='kammer'), Topic(percentage=0.013, word='zeuge')])], TopicCollection(percentage=0.0, topics=[Topic(percentage=0.0, word='')]), [TopicCollection(percentage=0.02163388416893431, topics=[Topic(percentage=0.077, word='rundfunk'), Topic(percentage=0.075, word='radio'), Topic(percentage=0.06, word='fernsehen'), Topic(percentage=0.047, word='sender'), Topic(percentage=0.044, word='programm'), Topic(percentage=0.014, word='angebot'), Topic(percentage=0.011, word='horfunk'), Topic(percentage=0.011, word='medium'), Topic(percentage=0.009, word='sendung'), Topic(percentage=0.009, word='fernsehsender')])], [TopicCollection(percentage=0.021616570469463192, topics=[Topic(percentage=0.146, word='afd'), Topic(percentage=0.033, word='pegida'), Topic(percentage=0.029, word='alternative'), Topic(percentage=0.02, word='deutschland'), Topic(percentage=0.017, word='volk'), Topic(percentage=0.014, word='bewegung'), Topic(percentage=0.013, word='lucke'), Topic(percentage=0.012, word='thema'), Topic(percentage=0.011, word='position'), Topic(percentage=0.01, word='bernd')])], TopicCollection(percentage=0.0, topics=[Topic(percentage=0.0, word='')]), [TopicCollection(percentage=0.021630578486623732, topics=[Topic(percentage=0.357, word='gemeinde'), Topic(percentage=0.097, word='kreis'), Topic(percentage=0.035, word='selbstverwaltung'), Topic(percentage=0.022, word='teil'), Topic(percentage=0.02, word='stadten'), Topic(percentage=0.019, word='burgermeister'), Topic(percentage=0.017, word='gemeinschaft'), Topic(percentage=0.014, word='landkreis'), Topic(percentage=0.011, word='jugendweihe'), Topic(percentage=0.01, word='landkreise')])], [TopicCollection(percentage=0.012398506313639774, topics=[Topic(percentage=0.06, word='putin'), Topic(percentage=0.055, word='prasident'), Topic(percentage=0.052, word='wladimir'), Topic(percentage=0.027, word='russland'), Topic(percentage=0.021, word='dmitrij'), Topic(percentage=0.016, word='medwedew'), Topic(percentage=0.016, word='sergej'), Topic(percentage=0.013, word='moskau'), Topic(percentage=0.012, word='rubel'), Topic(percentage=0.012, word='prasidenten')])], [TopicCollection(percentage=0.011252250522527426, topics=[Topic(percentage=0.223, word='mann'), Topic(percentage=0.056, word='frau'), Topic(percentage=0.04, word='manner'), Topic(percentage=0.026, word='vorstellung'), Topic(percentage=0.023, word='mannlichkeit'), Topic(percentage=0.022, word='rolle'), Topic(percentage=0.017, word='karriere'), Topic(percentage=0.016, word='verhalten'), Topic(percentage=0.011, word='junge'), Topic(percentage=0.011, word='macht')])], [TopicCollection(percentage=0.02163360785367091, topics=[Topic(percentage=0.136, word='geschlecht'), Topic(percentage=0.055, word='diskriminierung'), Topic(percentage=0.026, word='religion'), Topic(percentage=0.02, word='orientierung'), Topic(percentage=0.02, word='vielfalt'), Topic(percentage=0.018, word='sauer'), Topic(percentage=0.015, word='trans'), Topic(percentage=0.015, word='arn'), Topic(percentage=0.013, word='herkunft'), Topic(percentage=0.012, word='gender')])], [TopicCollection(percentage=0.02154903999246863, topics=[Topic(percentage=0.035, word='publikum'), Topic(percentage=0.031, word='geschichte'), Topic(percentage=0.02, word='figur'), Topic(percentage=0.02, word='szene'), Topic(percentage=0.019, word='theater'), Topic(percentage=0.019, word='inszenierung'), Topic(percentage=0.014, word='realitat'), Topic(percentage=0.012, word='ereignis'), Topic(percentage=0.012, word='zuschauer'), Topic(percentage=0.011, word='darstellung')])], [TopicCollection(percentage=0.022043975930107408, topics=[Topic(percentage=0.311, word='tag'), Topic(percentage=0.069, word='woche'), Topic(percentage=0.048, word='zeit'), Topic(percentage=0.047, word='stunde'), Topic(percentage=0.039, word='uhr'), Topic(percentage=0.032, word='monat'), Topic(percentage=0.019, word='nacht'), Topic(percentage=0.011, word='nachricht'), Topic(percentage=0.011, word='minute'), Topic(percentage=0.009, word='morgen')])], [TopicCollection(percentage=0.0216333710516871, topics=[Topic(percentage=0.092, word='staatsburgerschaft'), Topic(percentage=0.092, word='staatsangehorigkeit'), Topic(percentage=0.041, word='auslander'), Topic(percentage=0.029, word='einburgerung'), Topic(percentage=0.02, word='ausland'), Topic(percentage=0.02, word='person'), Topic(percentage=0.02, word='wahlrecht'), Topic(percentage=0.019, word='aufenthalt'), Topic(percentage=0.015, word='auslandern'), Topic(percentage=0.014, word='staatsangehorigen')])], [TopicCollection(percentage=0.021595617473645943, topics=[Topic(percentage=0.106, word='journalist'), Topic(percentage=0.065, word='korruption'), Topic(percentage=0.045, word='platz'), Topic(percentage=0.037, word='pressefreiheit'), Topic(percentage=0.03, word='grenze'), Topic(percentage=0.021, word='presse'), Topic(percentage=0.02, word='zensur'), Topic(percentage=0.02, word='medium'), Topic(percentage=0.019, word='freedom'), Topic(percentage=0.019, word='transparency')])], [TopicCollection(percentage=0.021211118272760968, topics=[Topic(percentage=0.084, word='bundeswehr'), Topic(percentage=0.072, word='einsatz'), Topic(percentage=0.059, word='soldat'), Topic(percentage=0.031, word='militar'), Topic(percentage=0.026, word='streitkrafte'), Topic(percentage=0.025, word='verteidigung'), Topic(percentage=0.023, word='armee'), Topic(percentage=0.016, word='dienst'), Topic(percentage=0.014, word='nva'), Topic(percentage=0.013, word='wehrpflicht')])], [TopicCollection(percentage=0.021143774633007234, topics=[Topic(percentage=0.077, word='rundfunk'), Topic(percentage=0.075, word='radio'), Topic(percentage=0.06, word='fernsehen'), Topic(percentage=0.047, word='sender'), Topic(percentage=0.044, word='programm'), Topic(percentage=0.014, word='angebot'), Topic(percentage=0.011, word='horfunk'), Topic(percentage=0.011, word='medium'), Topic(percentage=0.009, word='sendung'), Topic(percentage=0.009, word='fernsehsender')])], [TopicCollection(percentage=0.016690267955957124, topics=[Topic(percentage=0.1, word='verhandlung'), Topic(percentage=0.073, word='vertrag'), Topic(percentage=0.072, word='seite'), Topic(percentage=0.068, word='abkomme'), Topic(percentage=0.029, word='vereinbarung'), Topic(percentage=0.018, word='schritt'), Topic(percentage=0.017, word='abkommen'), Topic(percentage=0.017, word='umsetzung'), Topic(percentage=0.015, word='unterzeichnung'), Topic(percentage=0.015, word='grundlage')])], [TopicCollection(percentage=0.02114584473555968, topics=[Topic(percentage=0.357, word='gemeinde'), Topic(percentage=0.097, word='kreis'), Topic(percentage=0.035, word='selbstverwaltung'), Topic(percentage=0.022, word='teil'), Topic(percentage=0.02, word='stadten'), Topic(percentage=0.019, word='burgermeister'), Topic(percentage=0.017, word='gemeinschaft'), Topic(percentage=0.014, word='landkreis'), Topic(percentage=0.011, word='jugendweihe'), Topic(percentage=0.01, word='landkreise')])], [TopicCollection(percentage=0.04341632999188149, topics=[Topic(percentage=0.086, word='energie'), Topic(percentage=0.03, word='strom'), Topic(percentage=0.017, word='tschernobyl'), Topic(percentage=0.015, word='bau'), Topic(percentage=0.015, word='anteil'), Topic(percentage=0.013, word='kohle'), Topic(percentage=0.013, word='ausbau'), Topic(percentage=0.011, word='katastrophe'), Topic(percentage=0.011, word='energieeffizienz'), Topic(percentage=0.011, word='anlage')])], [TopicCollection(percentage=0.02337457149265381, topics=[Topic(percentage=0.043, word='gas'), Topic(percentage=0.037, word='gazprom'), Topic(percentage=0.032, word='ol'), Topic(percentage=0.024, word='erdgas'), Topic(percentage=0.024, word='milliarde'), Topic(percentage=0.021, word='kubikmeter'), Topic(percentage=0.02, word='stream'), Topic(percentage=0.018, word='erdol'), Topic(percentage=0.017, word='pipeline'), Topic(percentage=0.017, word='ukraine')])], [TopicCollection(percentage=0.014185239012384939, topics=[Topic(percentage=0.069, word='betrieb'), Topic(percentage=0.052, word='industrie'), Topic(percentage=0.039, word='wirtschaft'), Topic(percentage=0.021, word='landwirtschaft'), Topic(percentage=0.02, word='produktion'), Topic(percentage=0.012, word='teil'), Topic(percentage=0.011, word='marktwirtschaft'), Topic(percentage=0.01, word='sektor'), Topic(percentage=0.01, word='ende'), Topic(percentage=0.01, word='aufbau')])], [TopicCollection(percentage=0.013043015177816399, topics=[Topic(percentage=0.128, word='freund'), Topic(percentage=0.106, word='kontakt'), Topic(percentage=0.056, word='madchen'), Topic(percentage=0.042, word='eltern'), Topic(percentage=0.033, word='schule'), Topic(percentage=0.032, word='junge'), Topic(percentage=0.028, word='zeit'), Topic(percentage=0.026, word='haus'), Topic(percentage=0.018, word='vater'), Topic(percentage=0.017, word='mutter')])], TopicCollection(percentage=0.0, topics=[Topic(percentage=0.0, word='')]), TopicCollection(percentage=0.0, topics=[Topic(percentage=0.0, word='')])])

        result = DetectionResultRepository.get_page_paragraph_topics(
            DetectionResultRepository(mongodb, 'topic_modeling_collection'), page_id)

        print('result_test_get_page_paragraph_topics')
        print(result)
        print(expected_out)

        res = DetectionResultRepository.exists_page(DetectionResultRepository(mongodb, 'topic_modeling_collection'),
                                                    page_id=page_id)

        self.assertTrue(res == True)
        self.assertTrue(result == expected_out)

    def test_get_page_paragraph_top_topics(self):
        service, mongodb = TestDetectionResultRepository.setup_mongo(self)
        # resolver = TestDetectionResultRepository(service=service, mongodb=mongo)
        document_id = '11'
        project_id = '606ee5bf6769f83e24dc16cc'
        page_id = '122'
        info = ''
        expected_results = ([[0, 3], [3, 86], [86, 159], [159, 213], [213, 305], [305, 324], [324, 330], [330, 416], [416, 513], [513, 616], [616, 722], [722, 797], [797, 803], [803, 906], [906, 1009], [1009, 1046], [1046, 1153], [1153, 1251], [1251, 1356], [1356, 1455], [1455, 1527], [1527, 1533], [1533, 1626], [1626, 1727], [1727, 1773], [1773, 1855], [1855, 1956], [1956, 2018], [2018, 2105], [2105, 2185], [2185, 2190], [2190, 2190]], [[], ['luther', 'seite', 'reich'], ['terrorismus', 'terror', 'anschlag'], ['selbstverwaltung', 'teil', 'burgermeister'], ['soldat', 'militar', 'streitkrafte'], [], [], ['percent', 'development', 'billion'], ['gmbh', 'mahler', 'harald'], ['strom', 'kohle', 'katastrophe'], ['szene', 'syrien', 'minute'], ['platz', 'gebaude', 'straen'], [], ['perspektive', 'kontext', 'konzept'], ['honecker', 'plan', 'mittag'], ['schule', 'schulerinnen', 'abitur'], ['luther', 'seite', 'reich'], ['mandat', 'parlament', 'abgeordnete'], ['senat', 'kammer', 'zeuge'], [], ['radio', 'sender', 'medium'], [], ['selbstverwaltung', 'teil', 'burgermeister'], ['religion', 'sauer', 'herkunft'], ['uhr', 'nachricht', 'minute'], ['staatsburgerschaft', 'staatsangehorigkeit', 'einburgerung'], ['soldat', 'militar', 'streitkrafte'], ['selbstverwaltung', 'teil', 'burgermeister'], ['strom', 'kohle', 'katastrophe'], ['madchen', 'junge', 'haus'], [], []])

        result = DetectionResultRepository.get_page_paragraph_top_topics(
            DetectionResultRepository(mongodb, 'topic_modeling_collection'), page_id)

        print('result_test_get_page_paragraph_top_topics')
        print(result)


        res = DetectionResultRepository.exists_page(DetectionResultRepository(mongodb, 'topic_modeling_collection'),
                                                    page_id=page_id)

        self.assertTrue(res == True)
        self.assertTrue(result == expected_results)


    def setup_mongo(self):
        logging.basicConfig(level=logging.INFO)
        app_config = YamlConfig.load('.//resources/application.yml')
        model_setup = ModelSetup(app_config)
        topic_model = model_setup.creat_topic_model()

        mongodb = MongoDB(app_config['mongodb'])
        mongodb.connect()

        repository = DetectionResultRepository(mongodb, app_config['modell']['collection'])

        detection_listener = TopicRabbitListener(topic_model, repository, app_config['modell']['project_id'])
        return topic_model, mongodb